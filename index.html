
<!DOCTYPE html>

<html lang="th">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Zero e-waste Carbon Impact dashboard</title>
<style>
  :root{ --primary:#16a4dd; --ink:#1e1e1e; --muted:#666666; --bg:#ffffff; }
  *{box-sizing:border-box}
  body{ margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; color:var(--ink); background:var(--bg); }
  /* Background image behind content @ 90% opacity */
  body::after {
    content:"";
    position:fixed; inset:0;
    background: url("white paper.jpg") center/cover no-repeat;
    opacity:0.9; z-index:0; pointer-events:none;
  }
  header, main, .card, .container { position:relative; z-index:2; }
  header{ padding:28px 20px 12px; border-bottom:1px solid #eee; background:transparent; }
  .title{ font-size: clamp(22px, 4vw, 32px); font-weight: 800; letter-spacing: .2px; }
  .title .blue{ color: var(--primary); }
  .container{ max-width:1200px; margin:0 auto; padding:20px; }
  .grid{ display:grid; grid-template-columns: repeat(12, 1fr); gap:16px; }
  .card{ grid-column: span 12; background:#fff; border:1px solid #eee; border-radius:18px; padding:16px; box-shadow:0 10px 24px rgba(0,0,0,.04);}
  .kpi-grid{ display:grid; grid-template-columns: repeat(12, 1fr); gap:14px; margin:10px 0 6px; }
  .kpi{ grid-column: span 4; border:1px dashed #e8e8e8; border-radius:16px; padding:16px; position:relative; overflow:hidden; background:linear-gradient(180deg,#fff, #fafafa);}
  .kpi h3{ margin:0; font-size:14px; color:var(--muted); font-weight:600; }
  .kpi .value{ margin-top:6px; font-size: clamp(20px, 4vw, 32px); font-weight:800; letter-spacing:.3px; color:var(--ink);}
  .kpi .badge{ position:absolute; right:12px; top:12px; font-size:11px; color:#fff; background:var(--primary); padding:4px 8px; border-radius:999px; font-weight:700; opacity:.9; }
  .two-col{ display:grid; grid-template-columns: 1.2fr 1fr; gap:16px; }
  .panel-title{ font-weight:800; margin:0 0 6px; }
  .legend{ display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
  .legend span{ display:inline-flex; align-items:center; gap:6px; font-size:12px; color:var(--muted); border:1px solid #eee; padding:6px 8px; border-radius:10px; }
  .dot{ width:10px; height:10px; border-radius:50%; display:inline-block; }
  svg{ width:100%; height:100%; }
  .viz{ min-height:360px; display:grid; place-items:center; position:relative; }
  .viz-donut svg{ transform: scale(0.96); transform-origin: 50% 50%; } /* +20% from 0.8 baseline */
  .scroll-pane{ max-height: 300px; overflow: auto; border: 1px solid #eee; border-radius: 12px; background:#fff; }
  .hscroll{ overflow-x:auto; }
  .innerwide{ min-width: 1000px; }
  .tabs{ display:flex; gap:6px; margin-bottom:10px; }
  .tab{ border:1px solid #e6e6e6; color:var(--muted); background:#fff; padding:8px 12px; border-radius:12px; cursor:pointer; font-weight:700; font-size:13px; }
  .tab.active{ background:var(--primary); color:#fff; border-color:var(--primary); }
  .table{ width:100%; border-collapse:collapse; font-size:13px; border:1px solid #eee; border-radius:12px; overflow:hidden; background:#fff; }
  .table th, .table td{ padding:10px 12px; border-bottom:1px solid #f3f3f3; text-align:left;}
  .table th{ background:#fafafa; color:#333; font-weight:800; font-size:12px; }
  .tooltip{
    position:fixed; pointer-events:none; z-index:9999;
    background:#fff; color:#1e1e1e; border:1px solid #e6e6e6; border-radius:10px;
    padding:8px 10px; font-size:12px; box-shadow:0 8px 20px rgba(0,0,0,.08);
    transform:translate(-50%,-120%); white-space:nowrap;
  }
  .logo-fixed{ position:fixed; top:12px; right:14px; width:56px; height:auto; z-index:3; opacity:0.95; pointer-events:none; }
  @media (max-width: 980px){ .two-col{ grid-template-columns: 1fr; } .kpi{ grid-column: span 12; } }

/* v18: legend selected outline */
.legend span.selected{ border-color:#16a4dd !important; box-shadow:0 0 0 2px rgba(22,164,221,0.2); }
/* Ensure donut shows larger (as requested earlier) */
.viz-donut svg{ transform: scale(0.96); transform-origin: 50% 50%; }

/* ===== v20 Responsive Enhancements ===== */
.container{ max-width:1200px; margin:0 auto; padding: clamp(12px, 2vw, 20px); }
.viz{ min-height: 360px; }
.table thead th{ position: sticky; top: 0; z-index: 1; }
.scroll-pane{ max-height: 60vh; -webkit-overflow-scrolling: touch; }
.hscroll{ overflow-x:auto; -webkit-overflow-scrolling: touch; }
#legend-controls{ display:flex; gap:8px; flex-wrap: wrap; }
#legend-controls .tab{ flex: 0 0 auto; }
.legend span{ touch-action: manipulation; }
/* KPI grid: 3 -> 2 -> 1 columns via grid-span */
@media (max-width: 1024px){
  .two-col{ grid-template-columns: 1fr; }
  .kpi{ grid-column: span 6; }
  .viz{ min-height: 340px; }
  .viz-donut svg{ transform: scale(1.02); }
}
@media (max-width: 720px){
  .kpi{ grid-column: span 12; }
  .title{ font-size: clamp(20px, 6vw, 28px); }
  .viz{ min-height: 300px; }
  .viz-donut svg{ transform: scale(1.08); }
  .innerwide{ min-width: 680px; }
}
@media (max-width: 520px){
  .viz{ min-height: 280px; }
  .viz-donut svg{ transform: scale(1.12); }
  #legend-controls .tab{ flex: 1 1 45%; text-align:center; }
  .table th, .table td{ padding:8px 10px; }
  .innerwide{ min-width: 520px; }
}
/* Improve sticky header visibility */
.table th{ background:#fafafa; box-shadow: 0 2px 0 rgba(0,0,0,.03); }
/* Legend selected outline already present; emphasize on mobile */
@media (hover: none){
  .legend span.selected{ box-shadow:0 0 0 3px rgba(22,164,221,0.25); }
}
</style>
</head>
<body><script>
window.CSV_AGG = {"ถ่านไฟฉาย (Battery)": {"qty": 386, "weight": 7.72, "carbon": 29.72}, "สายชาร์จโทรศัพท์ (Phone charger)": {"qty": 70, "weight": 3.5, "carbon": 13.48}, "อแดปเตอร์ (Adapter)": {"qty": 48, "weight": 9.6, "carbon": 36.96}, "เม้าส์ (Mouse)": {"qty": 45, "weight": 4.5, "carbon": 17.32}, "ฮาร์ดดิสก์ (Hard disk)": {"qty": 39, "weight": 7.8, "carbon": 30.03}, "หูฟัง (Earphones/Headphones)": {"qty": 38, "weight": 1.9, "carbon": 7.32}, "การ์ดรีดเดอร์ (Card reader) / ยูเอสบี (USB)": {"qty": 37, "weight": 1.85, "carbon": 7.12}, "แบตเตอรี่โทรศัพท์ (Phone battery)": {"qty": 35, "weight": 1.58, "carbon": 6.06}, "ชิ้นส่วนคอมพิวเตอร์ (Computer parts)": {"qty": 32, "weight": 9.6, "carbon": 36.96}, "โทรศัพท์มือถือ (Phone)": {"qty": 28, "weight": 5.6, "carbon": 21.56}, "จอยเกม (Joystick)": {"qty": 18, "weight": 5.4, "carbon": 20.79}, "รีโมท (Remote)": {"qty": 18, "weight": 1.8, "carbon": 6.93}, "นาฬิกา (Clock)": {"qty": 12, "weight": 2.4, "carbon": 9.24}, "แท็บเล็ต (Tablet)": {"qty": 9, "weight": 4.5, "carbon": 17.32}, "ลำโพง (Speakers)": {"qty": 8, "weight": 4.0, "carbon": 15.4}, "คีย์บอร์ด (Keyboard)": {"qty": 8, "weight": 4.0, "carbon": 15.4}, "เครื่องเล่น DVD (DVD player)": {"qty": 6, "weight": 6.0, "carbon": 23.1}, "โทรศัพท์บ้าน (Telephone)": {"qty": 6, "weight": 2.4, "carbon": 9.24}, "สายชาร์จโน๊ตบุ๊ก (Laptop charger)": {"qty": 6, "weight": 1.2, "carbon": 4.62}, "เครื่องคิดเลข (Calculator)": {"qty": 6, "weight": 0.6, "carbon": 2.31}, "เครื่องม้วนผม (Hair curler) / เครื่องหนีบผม (Hair straightener)": {"qty": 4, "weight": 2.0, "carbon": 7.7}, "แบตเตอรี่โน๊ตบุ๊ก (Laptop battery)": {"qty": 4, "weight": 1.0, "carbon": 3.85}, "อะแดปเตอร์ (Adaptor)": {"qty": 4, "weight": 0.8, "carbon": 3.08}, "อุปกรณ์สำรองไฟ (UPS)": {"qty": 3, "weight": 24.0, "carbon": 92.4}, "โน๊ตบุ๊ก (Laptop)": {"qty": 3, "weight": 4.5, "carbon": 17.32}, "ไดร์เป่าผม (Hair dryer)": {"qty": 3, "weight": 1.8, "carbon": 6.93}, "วิทยุสื่อสาร (Radio)": {"qty": 3, "weight": 1.5, "carbon": 5.78}, "เครื่องเล่น MP3 (MP3 player)": {"qty": 2, "weight": 0.2, "carbon": 0.77}, "อินเตอร์เน็ตเราเตอร์ (Internet router)": {"qty": 1, "weight": 0.5, "carbon": 1.92}, "กล้องถ่ายรูป (Camera)": {"qty": 1, "weight": 0.4, "carbon": 1.54}};
window.CSV_TOTALS = {"items": 883, "weight": 122.65, "carbon": 472.17};
</script>
<img alt="Logo" class="logo-fixed" src="images/logo-idc.png"/>
<header>
<div class="container">
<div class="title"><span class="blue">Zero e-waste</span> Carbon Impact dashboard</div>
</div>
</header>
<main class="container">
<section class="card">
<div class="kpi-grid">
<div class="kpi">
<div class="badge">TOTAL</div>
<h3>Total carbon scores</h3>
<div class="value"><span id="kpi-carbon">-</span> <span style="font-size:14px; font-weight:700; color:var(--muted)">Kg CO₂e</span></div>
</div>
<div class="kpi">
<div class="badge">TOTAL</div>
<h3>Total items</h3>
<div class="value"><span id="kpi-items">-</span> <span style="font-size:14px; font-weight:700; color:var(--muted)">items</span></div>
</div>
<div class="kpi">
<div class="badge">TOTAL</div>
<h3>Total weights</h3>
<div class="value"><span id="kpi-weights">-</span> <span style="font-size:14px; font-weight:700; color:var(--muted)">kg</span></div>
</div>
</div>
<div class="subtle">*Filter โดยคลิกที่ชิ้นส่วนของ donut หรือคลิกที่แท็กสีใต้ตาราง (Select all / Clear).</div>
</section>
<section class="grid" style="margin-top:14px;">
<div class="card" style="grid-column: span 12">
<h3 class="panel-title">สัดส่วนร้อยละของขยะแต่ละประเภท (Donut chart)</h3>
<div class="two-col">
<div class="viz viz-donut">
<svg aria-label="e-waste donut chart" id="donut" viewbox="0 0 320 320"></svg>
<div class="tooltip" id="tt" style="display:none;"></div>
</div>
<div>
<div class="scroll-pane">
<table class="table" id="typeTable">
<thead><tr>
<th>ประเภท</th>
<th style="width:120px;">จำนวน (ชิ้น)</th>
<th style="width:120px;">สัดส่วน (%)</th>
<th style="width:180px;">Carbon Score (kg CO₂e)</th>
</tr></thead>
<tbody></tbody>
</table>
</div>
<div id="legend-controls" style="margin-top:8px;">
<button class="tab" id="btnSelectAll">Select all</button>
<button class="tab" id="btnClear">Clear</button>
</div>
<div class="legend" id="legend"></div>
</div>
</div>
</div>
<div class="card" style="grid-column: span 12">
<div class="tabs">
<button class="tab active" data-tab="people">Top 5 Individuals</button>
<button class="tab" data-tab="departments">Top 5 Departments</button>
</div>
<div id="tab-panels">
<div id="panel-people">
<div class="hscroll"><div class="innerwide">
<div class="two-col">
<div class="viz"><svg id="bar-people" viewbox="0 0 680 320"></svg></div>
<div>
<div class="scroll-pane">
<table class="table" id="tbl-people">
<thead><tr><th>บุคคล</th><th style="width:160px;">Carbon Score (kg CO₂e)</th><th style="width:90px;">จำนวน (ชิ้น)</th></tr></thead>
<tbody></tbody>
</table>
</div>
</div>
</div>
</div></div>
</div>
<div id="panel-departments" style="display:none;">
<div class="hscroll"><div class="innerwide">
<div class="two-col">
<div class="viz"><svg id="bar-dept" viewbox="0 0 680 320"></svg></div>
<div>
<div class="scroll-pane">
<table class="table" id="tbl-dept">
<thead><tr><th>หน่วยงาน</th><th style="width:160px;">Carbon Score (kg CO₂e)</th><th style="width:90px;">จำนวน (ชิ้น)</th></tr></thead>
<tbody></tbody>
</table>
</div>
</div>
</div>
</div></div>
</div>
</div>
<div class="subtle" style="margin-top:8px">*เลื่อนไปทางซ้าย/ขวาเพื่อดูข้อมูลเพิ่มเติม</div>
</div>
</section>
<section class="card" style="grid-column: span 12">
<div class="subtle">
        วิธีคำนวณ (ศักยภาพการลดคาร์บอนเมื่อรีไซเคิล 100%): สำหรับแต่ละประเภทคำนวณ <b>Total Weight (kg) = จำนวนชิ้น × น้ำหนักเฉลี่ยต่อชิ้น</b> แล้วหา
        <b>Carbon Score (kg CO₂e) = Total Weight (kg) × 3.85</b> จากนั้นรวมทุกประเภทเป็น Total Carbon Score
      </div>
</section>
</main>
<script>
// Data embed
const EMBEDDED_ROWS = [{"name": "สุภาวดี ทองมา", "department": "คณะบริหารธุรกิจ (บธ.)", "item_type": "โทรศัพท์มือถือ (Phone)", "quantity": 1.0}, {"name": "สุภาวดี ทองมา", "department": "คณะบริหารธุรกิจ (บธ.)", "item_type": "แบตเตอรี่โทรศัพท์ (Phone battery)", "quantity": 1.0}, {"name": "สุภาวดี ทองมา", "department": "คณะบริหารธุรกิจ (บธ.)", "item_type": "สายชาร์จโทรศัพท์ (Phone charger)", "quantity": 2.0}, {"name": "สุภาวดี ทองมา", "department": "คณะบริหารธุรกิจ (บธ.)", "item_type": "อแดปเตอร์ (Adapter)", "quantity": 1.0}, {"name": "สุภาวดี ทองมา", "department": "คณะบริหารธุรกิจ (บธ.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 1.0}, {"name": "สุภาวดี ทองมา", "department": "คณะบริหารธุรกิจ (บธ.)", "item_type": "ลำโพง (Speakers)", "quantity": 1.0}, {"name": "สุภาวดี ทองมา", "department": "คณะบริหารธุรกิจ (บธ.)", "item_type": "โทรศัพท์บ้าน (Telephone)", "quantity": 1.0}, {"name": "ชนาภัทร บุญเกิด", "department": "คณะสถิติประยุกต์ (สป.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 50.0}, {"name": "สุภักตรา เส็งหะพันธุ์", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "เม้าส์ (Mouse)", "quantity": 1.0}, {"name": "สุภักตรา เส็งหะพันธุ์", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "ไดร์เป่าผม (Hair dryer)", "quantity": 1.0}, {"name": "วิภาพร พรมเมือง", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "โทรศัพท์มือถือ (Phone)", "quantity": 3.0}, {"name": "วิภาพร พรมเมือง", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "แบตเตอรี่โทรศัพท์ (Phone battery)", "quantity": 3.0}, {"name": "สุรพงศ์ เนาวเศรษฐ์", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "โทรศัพท์บ้าน (Telephone)", "quantity": 1.0}, {"name": "สุรพงศ์ เนาวเศรษฐ์", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "เม้าส์ (Mouse)", "quantity": 4.0}, {"name": "สุรพงศ์ เนาวเศรษฐ์", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "ชิ้นส่วนคอมพิวเตอร์ (Computer parts)", "quantity": 1.0}, {"name": "สุรพงศ์ เนาวเศรษฐ์", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "จอยเกม (Joystick)", "quantity": 14.0}, {"name": "คณาธิศ พี่กั๊ก", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "แบตเตอรี่โทรศัพท์ (Phone battery)", "quantity": 4.0}, {"name": "คณาธิศ พี่กั๊ก", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "อแดปเตอร์ (Adapter)", "quantity": 1.0}, {"name": "คณาธิศ พี่กั๊ก", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "แบตเตอรี่โน๊ตบุ๊ก (Laptop battery)", "quantity": 1.0}, {"name": "คณาธิศ พี่กั๊ก", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 107.0}, {"name": "คณาธิศ พี่กั๊ก", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "จอยเกม (Joystick)", "quantity": 1.0}, {"name": "คณาธิศ พี่กั๊ก", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "วิทยุสื่อสาร (Radio)", "quantity": 3.0}, {"name": "เสริมศักดิ์ สุนทรศัพท์", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 1.0}, {"name": "เสริมศักดิ์ สุนทรศัพท์", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "จอยเกม (Joystick)", "quantity": 1.0}, {"name": "วิไลวรรณ นวลช่วย", "department": "คณะภาษาและการสื่อสาร (ภส.)", "item_type": "โทรศัพท์มือถือ (Phone)", "quantity": 6.0}, {"name": "วิไลวรรณ นวลช่วย", "department": "คณะภาษาและการสื่อสาร (ภส.)", "item_type": "แบตเตอรี่โทรศัพท์ (Phone battery)", "quantity": 6.0}, {"name": "วิไลวรรณ นวลช่วย", "department": "คณะภาษาและการสื่อสาร (ภส.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 1.0}, {"name": "วิไลวรรณ นวลช่วย", "department": "คณะภาษาและการสื่อสาร (ภส.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 1.0}, {"name": "นิธิดา วันชัยนาวิน", "department": "คณะภาษาและการสื่อสาร (ภส.)", "item_type": "โทรศัพท์มือถือ (Phone)", "quantity": 2.0}, {"name": "นิธิดา วันชัยนาวิน", "department": "คณะภาษาและการสื่อสาร (ภส.)", "item_type": "แบตเตอรี่โทรศัพท์ (Phone battery)", "quantity": 2.0}, {"name": "นิธิดา วันชัยนาวิน", "department": "คณะภาษาและการสื่อสาร (ภส.)", "item_type": "แท็บเล็ต (Tablet)", "quantity": 1.0}, {"name": "นิธิดา วันชัยนาวิน", "department": "คณะภาษาและการสื่อสาร (ภส.)", "item_type": "เครื่องม้วนผม (Hair curler) / เครื่องหนีบผม (Hair straightener)", "quantity": 1.0}, {"name": "นางสาวบุษราคัม หมื่นทอง", "department": "คณะภาษาและการสื่อสาร (ภส.)", "item_type": "การ์ดรีดเดอร์ (Card reader) / ยูเอสบี (USB)", "quantity": 34.0}, {"name": "นศ.ปทุมวดี  โลศิริ", "department": "คณะพัฒนาสังคมและยุทธศาสตร์การบริหาร (พค.)", "item_type": "โทรศัพท์มือถือ (Phone)", "quantity": 1.0}, {"name": "นศ.ปทุมวดี  โลศิริ", "department": "คณะพัฒนาสังคมและยุทธศาสตร์การบริหาร (พค.)", "item_type": "แบตเตอรี่โทรศัพท์ (Phone battery)", "quantity": 1.0}, {"name": "นศ.ปทุมวดี  โลศิริ", "department": "คณะพัฒนาสังคมและยุทธศาสตร์การบริหาร (พค.)", "item_type": "แท็บเล็ต (Tablet)", "quantity": 1.0}, {"name": "นศ.ปทุมวดี  โลศิริ", "department": "คณะพัฒนาสังคมและยุทธศาสตร์การบริหาร (พค.)", "item_type": "สายชาร์จโทรศัพท์ (Phone charger)", "quantity": 5.0}, {"name": "นศ.ปทุมวดี  โลศิริ", "department": "คณะพัฒนาสังคมและยุทธศาสตร์การบริหาร (พค.)", "item_type": "ลำโพง (Speakers)", "quantity": 2.0}, {"name": "นศ.ปทุมวดี  โลศิริ", "department": "คณะพัฒนาสังคมและยุทธศาสตร์การบริหาร (พค.)", "item_type": "สายชาร์จโน๊ตบุ๊ก (Laptop charger)", "quantity": 1.0}, {"name": "ศรายุทธ เอี่ยมสมบัติ", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "สายชาร์จโทรศัพท์ (Phone charger)", "quantity": 9.0}, {"name": "ศรายุทธ เอี่ยมสมบัติ", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "เม้าส์ (Mouse)", "quantity": 1.0}, {"name": "ศรายุทธ เอี่ยมสมบัติ", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "เครื่องคิดเลข (Calculator)", "quantity": 1.0}, {"name": "ศรายุทธ เอี่ยมสมบัติ", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "เครื่องม้วนผม (Hair curler) / เครื่องหนีบผม (Hair straightener)", "quantity": 2.0}, {"name": "นายสรายุทธ เอี่ยมสมบัติ", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "โทรศัพท์มือถือ (Phone)", "quantity": 3.0}, {"name": "นายสรายุทธ เอี่ยมสมบัติ", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "แบตเตอรี่โทรศัพท์ (Phone battery)", "quantity": 3.0}, {"name": "นายสรายุทธ เอี่ยมสมบัติ", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "อแดปเตอร์ (Adapter)", "quantity": 1.0}, {"name": "นายสรายุทธ เอี่ยมสมบัติ", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "โทรศัพท์บ้าน (Telephone)", "quantity": 1.0}, {"name": "นายสรายุทธ เอี่ยมสมบัติ", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "เครื่องคิดเลข (Calculator)", "quantity": 1.0}, {"name": "นายสรายุทธ เอี่ยมสมบัติ", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "รีโมท (Remote)", "quantity": 3.0}, {"name": "อัญญา นิ่มสุข", "department": "คณะบริหารการพัฒนาสิ่งแวดล้อม (สว.)", "item_type": "สายชาร์จโทรศัพท์ (Phone charger)", "quantity": 1.0}, {"name": "อัญญา นิ่มสุข", "department": "คณะบริหารการพัฒนาสิ่งแวดล้อม (สว.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 1.0}, {"name": "อัญญา นิ่มสุข", "department": "คณะบริหารการพัฒนาสิ่งแวดล้อม (สว.)", "item_type": "เม้าส์ (Mouse)", "quantity": 3.0}, {"name": "อัญญา นิ่มสุข", "department": "คณะบริหารการพัฒนาสิ่งแวดล้อม (สว.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 2.0}, {"name": "เสริมศักดิ์ สุนทรศัพท์", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 1.0}, {"name": "เสริมศักดิ์ สุนทรศัพท์", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "จอยเกม (Joystick)", "quantity": 1.0}, {"name": "อัจฉริยา เปรมเหล็ก", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 1.0}, {"name": "อัจฉริยา เปรมเหล็ก", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "คีย์บอร์ด (Keyboard)", "quantity": 1.0}, {"name": "ภูริณัฐ มะแป้น", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 1.0}, {"name": "พงศ์วิษณุ หูทิพย์", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "เม้าส์ (Mouse)", "quantity": 1.0}, {"name": "วราเทพ รัตนวรรณี", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "โน๊ตบุ๊ก (Laptop)", "quantity": 1.0}, {"name": "วราเทพ รัตนวรรณี", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "แบตเตอรี่โน๊ตบุ๊ก (Laptop battery)", "quantity": 1.0}, {"name": "วราเทพ รัตนวรรณี", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "ฮาร์ดดิสก์ (Hard disk)", "quantity": 1.0}, {"name": "ประภาพรรณ มานิตสุภวงษ์", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 5.0}, {"name": "ประภาพรรณ มานิตสุภวงษ์", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "รีโมท (Remote)", "quantity": 1.0}, {"name": "ธวัชชัย กาวรรณ", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "เม้าส์ (Mouse)", "quantity": 9.0}, {"name": "ธวัชชัย กาวรรณ", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "ฮาร์ดดิสก์ (Hard disk)", "quantity": 36.0}, {"name": "ธวัชชัย กาวรรณ", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "ชิ้นส่วนคอมพิวเตอร์ (Computer parts)", "quantity": 31.0}, {"name": "ธวัชชัย กาวรรณ", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "เครื่องเล่น DVD (DVD player)", "quantity": 4.0}, {"name": "ธวัชชัย กาวรรณ", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "การ์ดรีดเดอร์ (Card reader) / ยูเอสบี (USB)", "quantity": 1.0}, {"name": "กฤตย์ บุญชนะวิวัฒน์", "department": "กองบริการการศึกษา (กบ.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 3.0}, {"name": "อิลฮาม เด่นยิ่งโยชน์", "department": "สำนักวิจัย (วจ.)", "item_type": "สายชาร์จโน๊ตบุ๊ก (Laptop charger)", "quantity": 1.0}, {"name": "อิลฮาม เด่นยิ่งโยชน์", "department": "สำนักวิจัย (วจ.)", "item_type": "นาฬิกา (Clock)", "quantity": 1.0}, {"name": "นางสาวรัชชา เชาวน์ศิริ", "department": "สำนักวิจัย (วจ.)", "item_type": "รีโมท (Remote)", "quantity": 1.0}, {"name": "ทัศนีย์ ทองคำ", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "โทรศัพท์มือถือ (Phone)", "quantity": 1.0}, {"name": "ทัศนีย์ ทองคำ", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "แบตเตอรี่โทรศัพท์ (Phone battery)", "quantity": 2.0}, {"name": "ทัศนีย์ ทองคำ", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "แท็บเล็ต (Tablet)", "quantity": 1.0}, {"name": "ทัศนีย์ ทองคำ", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 1.0}, {"name": "ทัศนีย์ ทองคำ", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 30.0}, {"name": "ทัศนีย์ ทองคำ", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "นาฬิกา (Clock)", "quantity": 3.0}, {"name": "วรวุฒิ แสงเรือง", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "เม้าส์ (Mouse)", "quantity": 1.0}, {"name": "วิไลรัตน์ เชวงกฤตยานนท์", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "สายชาร์จโทรศัพท์ (Phone charger)", "quantity": 3.0}, {"name": "วิไลรัตน์ เชวงกฤตยานนท์", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 4.0}, {"name": "ปาริชาติ บ่อคำ", "department": "คณะนิเทศศาสตร์และนวัตกรรมการจัดการ (นน.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 6.0}, {"name": "ปาริชาติ บ่อคำ", "department": "คณะนิเทศศาสตร์และนวัตกรรมการจัดการ (นน.)", "item_type": "เม้าส์ (Mouse)", "quantity": 3.0}, {"name": "ปาริชาติ บ่อคำ", "department": "คณะนิเทศศาสตร์และนวัตกรรมการจัดการ (นน.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 2.0}, {"name": "นางสาวอรจารีย์ อาจหาญ", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "โทรศัพท์มือถือ (Phone)", "quantity": 2.0}, {"name": "นางสาวอรจารีย์ อาจหาญ", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "แบตเตอรี่โทรศัพท์ (Phone battery)", "quantity": 2.0}, {"name": "ศรัญญา วงษ์มาน", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "โทรศัพท์มือถือ (Phone)", "quantity": 1.0}, {"name": "ศรัญญา วงษ์มาน", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "แบตเตอรี่โทรศัพท์ (Phone battery)", "quantity": 1.0}, {"name": "ศรัญญา วงษ์มาน", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "แท็บเล็ต (Tablet)", "quantity": 1.0}, {"name": "ศรัญญา วงษ์มาน", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "อแดปเตอร์ (Adapter)", "quantity": 3.0}, {"name": "ศรัญญา วงษ์มาน", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "เม้าส์ (Mouse)", "quantity": 2.0}, {"name": "ศรัญญา วงษ์มาน", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "เครื่องคิดเลข (Calculator)", "quantity": 2.0}, {"name": "ศรัญญา วงษ์มาน", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "รีโมท (Remote)", "quantity": 2.0}, {"name": "ภาวิณี ภางาม", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "แท็บเล็ต (Tablet)", "quantity": 2.0}, {"name": "ภาวิณี ภางาม", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "เครื่องคิดเลข (Calculator)", "quantity": 1.0}, {"name": "ศรัญญา วงษ์มาน", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "เม้าส์ (Mouse)", "quantity": 2.0}, {"name": "ศรัญญา วงษ์มาน", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "รีโมท (Remote)", "quantity": 2.0}, {"name": "สุนทรพจน์  ไทยพ่วง", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 1.0}, {"name": "สุนทรพจน์  ไทยพ่วง", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "ฮาร์ดดิสก์ (Hard disk)", "quantity": 1.0}, {"name": "สายพิน  ทองคำ", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "โทรศัพท์มือถือ (Phone)", "quantity": 1.0}, {"name": "สายพิน  ทองคำ", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "แบตเตอรี่โทรศัพท์ (Phone battery)", "quantity": 1.0}, {"name": "สายพิน  ทองคำ", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "แท็บเล็ต (Tablet)", "quantity": 1.0}, {"name": "สายพิน  ทองคำ", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 1.0}, {"name": "พวงผกา ศรีระษา", "department": "สำนักสิริพัฒนา (สพ.)", "item_type": "โทรศัพท์มือถือ (Phone)", "quantity": 2.0}, {"name": "พวงผกา ศรีระษา", "department": "สำนักสิริพัฒนา (สพ.)", "item_type": "แบตเตอรี่โทรศัพท์ (Phone battery)", "quantity": 2.0}, {"name": "พวงผกา ศรีระษา", "department": "สำนักสิริพัฒนา (สพ.)", "item_type": "สายชาร์จโทรศัพท์ (Phone charger)", "quantity": 2.0}, {"name": "พวงผกา ศรีระษา", "department": "สำนักสิริพัฒนา (สพ.)", "item_type": "อแดปเตอร์ (Adapter)", "quantity": 1.0}, {"name": "พวงผกา ศรีระษา", "department": "สำนักสิริพัฒนา (สพ.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 1.0}, {"name": "พวงผกา ศรีระษา", "department": "สำนักสิริพัฒนา (สพ.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 4.0}, {"name": "พวงผกา ศรีระษา", "department": "สำนักสิริพัฒนา (สพ.)", "item_type": "จอยเกม (Joystick)", "quantity": 1.0}, {"name": "พวงผกา ศรีระษา", "department": "สำนักสิริพัฒนา (สพ.)", "item_type": "การ์ดรีดเดอร์ (Card reader) / ยูเอสบี (USB)", "quantity": 1.0}, {"name": "พวงผกา ศรีระษา", "department": "สำนักสิริพัฒนา (สพ.)", "item_type": "รีโมท (Remote)", "quantity": 1.0}, {"name": "พวงผกา ศรีระษา", "department": "สำนักสิริพัฒนา (สพ.)", "item_type": "ไดร์เป่าผม (Hair dryer)", "quantity": 1.0}, {"name": "Natthasath Saksupanara", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "สายชาร์จโทรศัพท์ (Phone charger)", "quantity": 1.0}, {"name": "Natthasath Saksupanara", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "อแดปเตอร์ (Adapter)", "quantity": 1.0}, {"name": "Natthasath Saksupanara", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 1.0}, {"name": "Natthasath Saksupanara", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "ลำโพง (Speakers)", "quantity": 1.0}, {"name": "Natthasath Saksupanara", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "เม้าส์ (Mouse)", "quantity": 1.0}, {"name": "Natthasath Saksupanara", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "คีย์บอร์ด (Keyboard)", "quantity": 1.0}, {"name": "Natthasath Saksupanara", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "สายชาร์จโน๊ตบุ๊ก (Laptop charger)", "quantity": 1.0}, {"name": "Natthasath Saksupanara", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "อะแดปเตอร์ (Adaptor)", "quantity": 1.0}, {"name": "Natthasath Saksupanara", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 1.0}, {"name": "ปรียาภรณ์ โกฏิตระกูล", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "รีโมท (Remote)", "quantity": 2.0}, {"name": "ส่งศักดิ์ โสภาพ", "department": "กองคลังและพัสดุ (กค.)", "item_type": "อุปกรณ์สำรองไฟ (UPS)", "quantity": 1.0}, {"name": "มนัญชญาด์ กิ่งจันทร์", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 1.0}, {"name": "มนัญชญาด์ กิ่งจันทร์", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "โทรศัพท์บ้าน (Telephone)", "quantity": 1.0}, {"name": "มนัญชญาด์ กิ่งจันทร์", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "เม้าส์ (Mouse)", "quantity": 1.0}, {"name": "มนัญชญาด์ กิ่งจันทร์", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 9.0}, {"name": "มนัญชญาด์ กิ่งจันทร์", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "นาฬิกา (Clock)", "quantity": 3.0}, {"name": "เบญจพร อั้นทอง", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "แบตเตอรี่โทรศัพท์ (Phone battery)", "quantity": 1.0}, {"name": "เบญจพร อั้นทอง", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 3.0}, {"name": "เบญจพร อั้นทอง", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "รีโมท (Remote)", "quantity": 2.0}, {"name": "เบญจพร อั้นทอง", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "เครื่องเล่น MP3 (MP3 player)", "quantity": 2.0}, {"name": "สิริพักตร์ โมงขุนทด", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "อแดปเตอร์ (Adapter)", "quantity": 1.0}, {"name": "สิริพักตร์ โมงขุนทด", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "คีย์บอร์ด (Keyboard)", "quantity": 1.0}, {"name": "สิริพักตร์ โมงขุนทด", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "นาฬิกา (Clock)", "quantity": 5.0}, {"name": "ศรณา ชาติมาลา", "department": "กองยุทธศาสตร์และแผนงาน (กผ.)", "item_type": "สายชาร์จโทรศัพท์ (Phone charger)", "quantity": 1.0}, {"name": "ศรณา ชาติมาลา", "department": "กองยุทธศาสตร์และแผนงาน (กผ.)", "item_type": "อแดปเตอร์ (Adapter)", "quantity": 2.0}, {"name": "ศรณา ชาติมาลา", "department": "กองยุทธศาสตร์และแผนงาน (กผ.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 35.0}, {"name": "ศรณา ชาติมาลา", "department": "กองยุทธศาสตร์และแผนงาน (กผ.)", "item_type": "รีโมท (Remote)", "quantity": 1.0}, {"name": "นิตยา พะวงษ์", "department": "กองคลังและพัสดุ (กค.)", "item_type": "โทรศัพท์มือถือ (Phone)", "quantity": 1.0}, {"name": "นิตยา พะวงษ์", "department": "กองคลังและพัสดุ (กค.)", "item_type": "แบตเตอรี่โทรศัพท์ (Phone battery)", "quantity": 1.0}, {"name": "นิตยา พะวงษ์", "department": "กองคลังและพัสดุ (กค.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 2.0}, {"name": "นิตยา พะวงษ์", "department": "กองคลังและพัสดุ (กค.)", "item_type": "โน๊ตบุ๊ก (Laptop)", "quantity": 1.0}, {"name": "นิตยา พะวงษ์", "department": "กองคลังและพัสดุ (กค.)", "item_type": "แบตเตอรี่โน๊ตบุ๊ก (Laptop battery)", "quantity": 1.0}, {"name": "นิตยา พะวงษ์", "department": "กองคลังและพัสดุ (กค.)", "item_type": "เม้าส์ (Mouse)", "quantity": 1.0}, {"name": "นิตยา พะวงษ์", "department": "กองคลังและพัสดุ (กค.)", "item_type": "สายชาร์จโน๊ตบุ๊ก (Laptop charger)", "quantity": 1.0}, {"name": "นิตยา พะวงษ์", "department": "กองคลังและพัสดุ (กค.)", "item_type": "อะแดปเตอร์ (Adaptor)", "quantity": 2.0}, {"name": "นิตยา พะวงษ์", "department": "กองคลังและพัสดุ (กค.)", "item_type": "กล้องถ่ายรูป (Camera)", "quantity": 1.0}, {"name": "นิตยา พะวงษ์", "department": "กองคลังและพัสดุ (กค.)", "item_type": "เครื่องเล่น DVD (DVD player)", "quantity": 1.0}, {"name": "นิตยา พะวงษ์", "department": "กองคลังและพัสดุ (กค.)", "item_type": "อินเตอร์เน็ตเราเตอร์ (Internet router)", "quantity": 1.0}, {"name": "นิตยา พะวงษ์", "department": "กองคลังและพัสดุ (กค.)", "item_type": "ไดร์เป่าผม (Hair dryer)", "quantity": 1.0}, {"name": "นราวรรณ พลทรัพย์", "department": "สำนักบรรณสารการพัฒนา (บส.)", "item_type": "สายชาร์จโทรศัพท์ (Phone charger)", "quantity": 1.0}, {"name": "นางสาวภัทรลดา  วรพันธ์", "department": "กองคลังและพัสดุ (กค.)", "item_type": "ฮาร์ดดิสก์ (Hard disk)", "quantity": 1.0}, {"name": "นางสาวภัทรลดา  วรพันธ์", "department": "กองคลังและพัสดุ (กค.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 2.0}, {"name": "นางสาวภัทรลดา  วรพันธ์", "department": "กองคลังและพัสดุ (กค.)", "item_type": "เครื่องคิดเลข (Calculator)", "quantity": 1.0}, {"name": "นางสาวภัทรลดา  วรพันธ์", "department": "กองคลังและพัสดุ (กค.)", "item_type": "รีโมท (Remote)", "quantity": 1.0}, {"name": "มารยาท  ซิมเจริญ", "department": "กองคลังและพัสดุ (กค.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 5.0}, {"name": "วรนุช  ปราณี", "department": "กองคลังและพัสดุ (กค.)", "item_type": "โทรศัพท์มือถือ (Phone)", "quantity": 2.0}, {"name": "วรนุช  ปราณี", "department": "กองคลังและพัสดุ (กค.)", "item_type": "แท็บเล็ต (Tablet)", "quantity": 2.0}, {"name": "วรนุช  ปราณี", "department": "กองคลังและพัสดุ (กค.)", "item_type": "สายชาร์จโทรศัพท์ (Phone charger)", "quantity": 6.0}, {"name": "กาญจนา พุ่มพวง", "department": "กองคลังและพัสดุ (กค.)", "item_type": "อุปกรณ์สำรองไฟ (UPS)", "quantity": 1.0}, {"name": "ปรียาภรณ์ ครุฑใจแผ้ว", "department": "กองคลังและพัสดุ (กค.)", "item_type": "สายชาร์จโทรศัพท์ (Phone charger)", "quantity": 9.0}, {"name": "ปรียาภรณ์ ครุฑใจแผ้ว", "department": "กองคลังและพัสดุ (กค.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 4.0}, {"name": "ปรียาภรณ์ ครุฑใจแผ้ว", "department": "กองคลังและพัสดุ (กค.)", "item_type": "ลำโพง (Speakers)", "quantity": 1.0}, {"name": "ปรียาภรณ์ ครุฑใจแผ้ว", "department": "กองคลังและพัสดุ (กค.)", "item_type": "การ์ดรีดเดอร์ (Card reader) / ยูเอสบี (USB)", "quantity": 1.0}, {"name": "มิ้น", "department": "กองคลังและพัสดุ (กค.)", "item_type": "สายชาร์จโทรศัพท์ (Phone charger)", "quantity": 3.0}, {"name": "มิ้น", "department": "กองคลังและพัสดุ (กค.)", "item_type": "อแดปเตอร์ (Adapter)", "quantity": 4.0}, {"name": "มิ้น", "department": "กองคลังและพัสดุ (กค.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 1.0}, {"name": "มิ้น", "department": "กองคลังและพัสดุ (กค.)", "item_type": "เม้าส์ (Mouse)", "quantity": 2.0}, {"name": "มิ้น", "department": "กองคลังและพัสดุ (กค.)", "item_type": "เครื่องเล่น DVD (DVD player)", "quantity": 1.0}, {"name": "มิ้น", "department": "กองคลังและพัสดุ (กค.)", "item_type": "รีโมท (Remote)", "quantity": 1.0}, {"name": "มิ้น", "department": "กองคลังและพัสดุ (กค.)", "item_type": "อุปกรณ์สำรองไฟ (UPS)", "quantity": 1.0}, {"name": "ธิติภา จันทรอาภา", "department": "กองคลังและพัสดุ (กค.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 2.0}, {"name": "ปนัตตา แก้วเศษ", "department": "กองคลังและพัสดุ (กค.)", "item_type": "สายชาร์จโทรศัพท์ (Phone charger)", "quantity": 16.0}, {"name": "ปนัตตา แก้วเศษ", "department": "กองคลังและพัสดุ (กค.)", "item_type": "อแดปเตอร์ (Adapter)", "quantity": 1.0}, {"name": "ปนัตตา แก้วเศษ", "department": "กองคลังและพัสดุ (กค.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 1.0}, {"name": "ปนัตตา แก้วเศษ", "department": "กองคลังและพัสดุ (กค.)", "item_type": "ลำโพง (Speakers)", "quantity": 3.0}, {"name": "ปนัตตา แก้วเศษ", "department": "กองคลังและพัสดุ (กค.)", "item_type": "เม้าส์ (Mouse)", "quantity": 5.0}, {"name": "ปนัตตา แก้วเศษ", "department": "กองคลังและพัสดุ (กค.)", "item_type": "คีย์บอร์ด (Keyboard)", "quantity": 3.0}, {"name": "ปนัตตา แก้วเศษ", "department": "กองคลังและพัสดุ (กค.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 10.0}, {"name": "ปนัตตา แก้วเศษ", "department": "กองคลังและพัสดุ (กค.)", "item_type": "รีโมท (Remote)", "quantity": 1.0}, {"name": "ณฐพัชร จันทร์วศิน", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "แบตเตอรี่โทรศัพท์ (Phone battery)", "quantity": 3.0}, {"name": "ณฐพัชร จันทร์วศิน", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "อแดปเตอร์ (Adapter)", "quantity": 26.0}, {"name": "ณฐพัชร จันทร์วศิน", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "โทรศัพท์บ้าน (Telephone)", "quantity": 1.0}, {"name": "ณฐพัชร จันทร์วศิน", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "เม้าส์ (Mouse)", "quantity": 6.0}, {"name": "ณฐพัชร จันทร์วศิน", "department": "คณะรัฐประศาสนศาสตร์ (รศ.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 103.0}, {"name": "คณิตรา แสงเรือง", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "โน๊ตบุ๊ก (Laptop)", "quantity": 1.0}, {"name": "คณิตรา แสงเรือง", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "แบตเตอรี่โน๊ตบุ๊ก (Laptop battery)", "quantity": 1.0}, {"name": "คณิตรา แสงเรือง", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "สายชาร์จโน๊ตบุ๊ก (Laptop charger)", "quantity": 1.0}, {"name": "คณิตรา แสงเรือง", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "อะแดปเตอร์ (Adaptor)", "quantity": 1.0}, {"name": "สรวิศ เจ็งสวัสดิ์", "department": "กองบริหารและพัฒนาทรัพยากรบุคคล (บค.)", "item_type": "เม้าส์ (Mouse)", "quantity": 1.0}, {"name": "กรองจิต สุขเกื้อ", "department": "สำนักบรรณสารการพัฒนา (บส.)", "item_type": "โทรศัพท์มือถือ (Phone)", "quantity": 2.0}, {"name": "กรองจิต สุขเกื้อ", "department": "สำนักบรรณสารการพัฒนา (บส.)", "item_type": "แบตเตอรี่โทรศัพท์ (Phone battery)", "quantity": 2.0}, {"name": "กรองจิต สุขเกื้อ", "department": "สำนักบรรณสารการพัฒนา (บส.)", "item_type": "สายชาร์จโทรศัพท์ (Phone charger)", "quantity": 1.0}, {"name": "ปัญชลี เรืองสมุทร", "department": "สำนักบรรณสารการพัฒนา (บส.)", "item_type": "เครื่องม้วนผม (Hair curler) / เครื่องหนีบผม (Hair straightener)", "quantity": 1.0}, {"name": "นฐพร พุฒเจริญ", "department": "สำนักบรรณสารการพัฒนา (บส.)", "item_type": "อแดปเตอร์ (Adapter)", "quantity": 1.0}, {"name": "นฐพร พุฒเจริญ", "department": "สำนักบรรณสารการพัฒนา (บส.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 2.0}, {"name": "นันทธภร ศิริโวหาร", "department": "สำนักบรรณสารการพัฒนา (บส.)", "item_type": "อแดปเตอร์ (Adapter)", "quantity": 2.0}, {"name": "นันทธภร ศิริโวหาร", "department": "สำนักบรรณสารการพัฒนา (บส.)", "item_type": "ถ่านไฟฉาย (Battery)", "quantity": 13.0}, {"name": "นันท์นภัส อุ่นนิ่ม", "department": "สำนักบรรณสารการพัฒนา (บส.)", "item_type": "สายชาร์จโทรศัพท์ (Phone charger)", "quantity": 10.0}, {"name": "นันท์นภัส อุ่นนิ่ม", "department": "สำนักบรรณสารการพัฒนา (บส.)", "item_type": "อแดปเตอร์ (Adapter)", "quantity": 3.0}, {"name": "นันท์นภัส อุ่นนิ่ม", "department": "สำนักบรรณสารการพัฒนา (บส.)", "item_type": "หูฟัง (Earphones/Headphones)", "quantity": 4.0}, {"name": "นันท์นภัส อุ่นนิ่ม", "department": "สำนักบรรณสารการพัฒนา (บส.)", "item_type": "คีย์บอร์ด (Keyboard)", "quantity": 2.0}, {"name": "ทิพวรรณ หล่อโลหพันธุ์", "department": "กองยุทธศาสตร์และแผนงาน (กผ.)", "item_type": "เม้าส์ (Mouse)", "quantity": 1.0}, {"name": "กศิมา คิ้วเจริญ", "department": "สำนักเทคโนโลยีดิจิทัลและสารสนเทศ IDT (ทส.)", "item_type": "สายชาร์จโน๊ตบุ๊ก (Laptop charger)", "quantity": 1.0}, {"name": "มัดยาดา ปรียากระ", "department": "สำนักบรรณสารการพัฒนา (บส.)", "item_type": "โทรศัพท์บ้าน (Telephone)", "quantity": 1.0}];
window.__EW_ROWS__ = EMBEDDED_ROWS.slice();

// Weights mapping (align with the Python table)
const AVG_WEIGHT_KG = {
  "โทรศัพท์มือถือ": 0.2,
  "แบตเตอรี่โทรศัพท์": 0.045,
  "แท็บเล็ต": 0.5,
  "สายชาร์จโทรศัพท์": 0.05, "สายชาร์จ/สายไฟเล็ก": 0.05,
  "อแดปเตอร์": 0.20, "อะแดปเตอร์": 0.20,
  "หูฟัง": 0.05,
  "ลำโพง": 0.5, "ลำโพงเล็ก": 0.5,
  "โทรศัพท์บ้าน": 0.4,
  "โน๊ตบุ๊ก": 1.5, "โน้ตบุ๊ก": 1.5,
  "แบตเตอรี่โน๊ตบุ๊ก": 0.25,
  "เม้าส์": 0.1,
  "คีย์บอร์ด": 0.5,
  "สายชาร์จโน๊ตบุ๊ก": 0.20,
  "ฮาร์ดดิสก์": 0.2,
  "ชิ้นส่วนคอมพิวเตอร์": 0.3, "ชิ้นส่วนคอมฯ": 0.3,
  "ถ่านไฟฉาย": 0.02,
  "กล้องถ่ายรูป": 0.4,
  "เครื่องเล่น dvd": 1.0,
  "จอยเกม": 0.3,
  "วิทยุสื่อสาร": 0.5,
  "เครื่องคิดเลข": 0.1,
  "นาฬิกา": 0.2,
  "การ์ดรีดเดอร์": 0.05, "ยูเอสบี": 0.05,
  "รีโมท": 0.1,
  "เครื่องเล่น mp3": 0.1,
  "ups": 8.0, "อุปกรณ์สำรองไฟ": 8.0,
  "อินเตอร์เน็ตเราเตอร์": 0.5, "router": 0.5,
  "เครื่องม้วนผม": 0.5, "เครื่องหนีบผม": 0.5,
  "ไดร์เป่าผม": 0.6
};

const FACTOR = 3.85;
let selectedTypes = null; // null = all selected

function norm(s){ return (s||"").toString().replace(/\\([^)]*\\)/g, "").trim().toLowerCase().replace(/\\s+/g," "); } // strip parentheses then normalize

function nice(num, digits=2){ if (!isFinite(num)) return "-"; return Number(num).toLocaleString(undefined,{maximumFractionDigits: digits}); }

function calcWeightForType(type){
  // strip parentheses, then try exact; if contains '/', split and try first token
  const raw = (type||"").toString();
  const stripped = raw.replace(/\\([^)]*\\)/g, "");
  const key = norm(stripped);
  if (AVG_WEIGHT_KG[key]!=null) return AVG_WEIGHT_KG[key];
  const baseFirst = key.split("/")[0].trim();
  if (AVG_WEIGHT_KG[baseFirst]!=null) return AVG_WEIGHT_KG[baseFirst];
  return 0.2;
}

function summarize(arr, filterSet=null){
  const byType = new Map(); const byPerson = new Map(); const byDept = new Map();
  let totalItems=0, totalWeight=0, totalScore=0;
  for (const r of arr){
    const t = r.item_type || "ไม่ระบุ";
    if (filterSet && !filterSet.has(t)) continue;
    const qty = r.quantity||0;
    const wPer = calcWeightForType(t);
    const weight = qty * wPer;
    const score = weight * FACTOR;
    totalItems += qty; totalWeight += weight; totalScore += score;
    const tx = byType.get(t) || {type:t, qty:0, weight:0, score:0};
    tx.qty += qty; tx.weight += weight; tx.score += score; byType.set(t, tx);
    const p = r.name || "ไม่ระบุ"; const px = byPerson.get(p) || {name:p, qty:0, weight:0, score:0};
    px.qty += qty; px.weight += weight; px.score += score; byPerson.set(p, px);
    const d = r.department || "ไม่ระบุ"; const dx = byDept.get(d) || {department:d, qty:0, weight:0, score:0};
    dx.qty += qty; dx.weight += weight; dx.score += score; byDept.set(d, dx);
  }
  const typeArr = Array.from(byType.values()).sort((a,b)=>b.qty-a.qty);
  const personArr = Array.from(byPerson.values()).sort((a,b)=>b.score-a.score);
  const deptArr = Array.from(byDept.values()).sort((a,b)=>b.score-a.score);
  return {typeArr, personArr, deptArr, totalItems, totalWeight, totalScore};
}

// Donut renderer with blue + gray + black palette
function drawDonut(el, rows){
  const svg = el; svg.innerHTML = "";
  const cx = 160, cy = 160, R = 130, r = 70;
  const sum = rows.reduce((s,r)=>s+(r.qty||0),0) || 1;
  const palette = [[22,164,221],[102,102,102],[0,0,0]];
  let a0 = -Math.PI/2;
  rows.forEach((row, i)=>{
    const frac = (row.qty||0)/sum;
    const a1 = a0 + (frac>0?frac:0)*2*Math.PI;
    if (frac<=0){ a0 = a1; return; }
    const large = (a1-a0) > Math.PI ? 1 : 0;
    const x0 = cx + R*Math.cos(a0), y0 = cy + R*Math.sin(a0);
    const x1 = cx + R*Math.cos(a1), y1 = cy + R*Math.sin(a1);
    const x2 = cx + r*Math.cos(a1), y2 = cy + r*Math.sin(a1);
    const x3 = cx + r*Math.cos(a0), y3 = cy + r*Math.sin(a0);
    const base = palette[i % palette.length];
    const color = `rgb(${base[0]},${base[1]},${base[2]})`;
    const path = document.createElementNS("http://www.w3.org/2000/svg","path");
    path.setAttribute("d",`M ${x0} ${y0} A ${R} ${R} 0 ${large} 1 ${x1} ${y1} L ${x2} ${y2} A ${r} ${r} 0 ${large} 0 ${x3} ${y3} Z`);
    path.setAttribute("fill", color); path.setAttribute("opacity","0.95");
    const pct = ((row.qty||0)/sum*100).toFixed(1);
    path.dataset.type = row.type; path.dataset.qty = row.qty; path.dataset.pct = pct;

    path.addEventListener("mouseenter", ()=>{
      const tt = document.getElementById("tt");
      const wPer = calcWeightForType(row.type);
      const score = (row.qty * wPer * FACTOR).toFixed(2);
      if (tt){
        tt.style.display="block";
        tt.innerHTML = `<b>${row.type}</b><br/>${Number(row.qty||0).toLocaleString()} ชิ้น • ${pct}%<br/>${score} kg CO₂e`;
      }
      path.setAttribute("opacity","1");
    });
    path.addEventListener("mousemove", (e)=>{
      const tt = document.getElementById("tt");
      if (tt){ tt.style.left = (e.clientX) + "px"; tt.style.top = (e.clientY - 10) + "px"; }
    });
    path.addEventListener("mouseleave", ()=>{
      const tt = document.getElementById("tt"); if (tt){ tt.style.display="none"; }
      path.setAttribute("opacity","0.95");
    });
    path.addEventListener("click", ()=>{
      const t = row.type;
      if (selectedTypes === null){ selectedTypes = new Set(); }
      if (selectedTypes.has(t)) selectedTypes.delete(t); else selectedTypes.add(t);
      rerender();
    });

    svg.appendChild(path);
    a0 = a1;
  });
  const totalText1 = document.createElementNS("http://www.w3.org/2000/svg","text");
  totalText1.setAttribute("x", cx); totalText1.setAttribute("y", cy-6);
  totalText1.setAttribute("text-anchor","middle"); totalText1.setAttribute("font-size","14"); totalText1.setAttribute("fill", "#666"); totalText1.textContent = "รวม"; svg.appendChild(totalText1);
  const totalText2 = document.createElementNS("http://www.w3.org/2000/svg","text");
  totalText2.setAttribute("x", cx); totalText2.setAttribute("y", cy+16);
  totalText2.setAttribute("text-anchor","middle"); totalText2.setAttribute("font-size","20"); totalText2.setAttribute("font-weight","800"); totalText2.setAttribute("fill", "#1e1e1e");
  totalText2.textContent = rows.reduce((s,r)=>s+(r.qty||0),0).toLocaleString(); svg.appendChild(totalText2);
}

// Bars with gradient blue->black for departments, blue->ink for people
function drawBars(el, rows, labelKey, valueKey, gradSuffix, lengthScale=0.8, endColor="#1e1e1e"){
  const svg = el; svg.innerHTML = "";
  const w = 680, h = 320, padL = 180, padR = 16, padT = 16, padB = 36;
  const maxV = Math.max(1, ...rows.map(r=>r[valueKey]||0));
  const barH = Math.min(42, (h - padT - padB) / rows.length - 6);
  const gap = 8;
  const defs = document.createElementNS("http://www.w3.org/2000/svg","defs");
  svg.appendChild(defs);
  rows.forEach((r, i)=>{
    const x = padL;
    const y = padT + i*(barH+gap);
    const ww = lengthScale * ((w - padL - padR) * (r[valueKey]||0)) / maxV;
    const bg = document.createElementNS("http://www.w3.org/2000/svg","rect");
    bg.setAttribute("x", x); bg.setAttribute("y", y);
    bg.setAttribute("width", w - padL - padR); bg.setAttribute("height", barH);
    bg.setAttribute("fill", "#f4f8fb"); svg.appendChild(bg);
    const gradId = `grad_${gradSuffix}_${i}`;
    const grad = document.createElementNS("http://www.w3.org/2000/svg","linearGradient");
    grad.setAttribute("id",gradId); grad.setAttribute("x1","0"); grad.setAttribute("x2","1"); grad.setAttribute("y1","0"); grad.setAttribute("y2","0");
    const s1 = document.createElementNS("http://www.w3.org/2000/svg","stop"); s1.setAttribute("offset","0%"); s1.setAttribute("stop-color","#16a4dd");
    const s2 = document.createElementNS("http://www.w3.org/2000/svg","stop"); s2.setAttribute("offset","100%"); s2.setAttribute("stop-color", endColor);
    grad.appendChild(s1); grad.appendChild(s2); defs.appendChild(grad);
    const bar = document.createElementNS("http://www.w3.org/2000/svg","rect");
    bar.setAttribute("x", x); bar.setAttribute("y", y);
    bar.setAttribute("rx","8"); bar.setAttribute("ry","8");
    bar.setAttribute("width", Math.max(2, ww)); bar.setAttribute("height", barH);
    bar.setAttribute("fill", `url(#${gradId})`); svg.appendChild(bar);
    const label = document.createElementNS("http://www.w3.org/2000/svg","text");
    label.setAttribute("x", padL - 8); label.setAttribute("y", y + barH/2 + 5);
    label.setAttribute("text-anchor","end"); label.setAttribute("font-size","13"); label.setAttribute("font-weight","700"); label.setAttribute("fill","#1e1e1e");
    label.textContent = r[labelKey]; svg.appendChild(label);
    const val = document.createElementNS("http://www.w3.org/2000/svg","text");
    val.setAttribute("x", x + Math.max(2, ww) + 8); val.setAttribute("y", y + barH/2 + 5);
    val.setAttribute("font-size","12"); val.setAttribute("fill","#666"); val.textContent = nice(r[valueKey], 2); svg.appendChild(val);
  });
  const axis = document.createElementNS("http://www.w3.org/2000/svg","line");
  axis.setAttribute("x1", padL); axis.setAttribute("y1", h-padB);
  axis.setAttribute("x2", w-padR); axis.setAttribute("y2", h-padB);
  axis.setAttribute("stroke", "#eee"); axis.setAttribute("stroke-width","1");
  svg.appendChild(axis);
}

// Tables
function updateTypeTable(rows){
  const tbody = document.querySelector("#typeTable tbody");
  const legend = document.getElementById("legend");
  tbody.innerHTML = ""; legend.innerHTML="";
  const sum = rows.reduce((s,r)=>s+(r.qty||0),0) || 1;
  rows.forEach((r,i)=>{
    const tr = document.createElement("tr");
    const pct = (100*(r.qty||0)/sum);
    const score = (r.qty||0) * calcWeightForType(r.type) * FACTOR;
    tr.innerHTML = `<td>${r.type}</td><td>${nice(r.qty,0)}</td><td>${pct.toFixed(1)}</td><td>${nice(score,2)}</td>`;
    tbody.appendChild(tr);
    const chip = document.createElement("span");
    chip.setAttribute("data-type", r.type);
    chip.innerHTML = `<i class="dot" style="background:${i%3===0?'#16a4dd':(i%3===1?'#666':'#000') }"></i>${r.type}`;
    chip.style.cursor="pointer";
    legend.appendChild(chip);
  });
}

// People/Dept tables show ALL entries sorted by carbon score desc
function updatePeopleTable(rows){
  const tbody = document.querySelector("#tbl-people tbody");
  tbody.innerHTML = "";
  rows.forEach(r=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${r.name}</td><td>${nice(r.score,2)}</td><td>${nice(r.qty,0)}</td>`;
    tbody.appendChild(tr);
  });
}
function updateDeptTable(rows){
  const tbody = document.querySelector("#tbl-dept tbody");
  tbody.innerHTML = "";
  rows.forEach(r=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${r.department}</td><td>${nice(r.score,2)}</td><td>${nice(r.qty,0)}</td>`;
    tbody.appendChild(tr);
  });
}

// Tabs
document.addEventListener("click", (e)=>{
  const btn = e.target.closest(".tab[data-tab]");
  if (!btn) return;
  document.querySelectorAll(".tab[data-tab]").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  const tab = btn.getAttribute("data-tab");
  document.querySelector("#panel-people").style.display = tab==="people" ? "block" : "none";
  document.querySelector("#panel-departments").style.display = tab==="departments" ? "block" : "none";
});

// Multi-select filter controls
document.getElementById("btnSelectAll").addEventListener("click", ()=>{ selectedTypes=null; rerender(); });
document.getElementById("btnClear").addEventListener("click", ()=>{ selectedTypes=new Set(); rerender(); });
document.getElementById("legend").addEventListener("click", (e)=>{
  const chip = e.target.closest("span[data-type]"); if(!chip) return;
  const t = chip.getAttribute("data-type");
  if (!selectedTypes){ selectedTypes = new Set(); }
  if (selectedTypes.has(t)) selectedTypes.delete(t); else selectedTypes.add(t);
  rerender();
});

function rerender(){
  const {typeArr: allTypeArr} = summarize(__EW_ROWS__, null);
  const {typeArr, personArr, deptArr, totalItems, totalWeight, totalScore} = summarize(__EW_ROWS__, selectedTypes);

  // Decide donut data
  let donutData = [];
  if (selectedTypes === null){ donutData = allTypeArr; }
  else if (selectedTypes instanceof Set && selectedTypes.size===0){ donutData = []; }
  else { donutData = typeArr; }

  // KPIs
  document.getElementById("kpi-items").textContent = nice(totalItems,0);
  document.getElementById("kpi-weights").textContent = nice(totalWeight,2);
  document.getElementById("kpi-carbon").textContent = nice(totalScore,2);

  // Donut + type table + legend
  drawDonut(document.getElementById('donut'), donutData);
  updateTypeTable(typeArr);

  // Charts (top5) & tables (full)
  drawBars(document.getElementById("bar-people"), personArr.slice(0,5), "name", "score", "people", 0.8, "#1e1e1e");
  updatePeopleTable(personArr);
  drawBars(document.getElementById("bar-dept"), deptArr.slice(0,5), "department", "score", "dept", 0.8, "#000000");
  updateDeptTable(deptArr);

  // Reflect legend chips selection state
  const legend = document.getElementById("legend");
  legend.querySelectorAll("span[data-type]").forEach(chip=>{
    const t = chip.getAttribute("data-type");
    const isSelected = !selectedTypes || selectedTypes.has(t);
    chip.style.opacity = isSelected ? "1" : "0.35";
    chip.style.borderColor = isSelected ? "#16a4dd" : "#eee";
  });
}

// Init
window.addEventListener("load", ()=>{
  rerender();
});
</script>
<script>
// v18 override: use CSV_AGG for type-level qty/weight/carbon; scale per-person/department to match CSV per type
(function(){
  const FACTOR = window.FACTOR || 3.85;
  window.selectedTypes = window.selectedTypes ?? null; // null = all

  function nice(num, digits=2){ if (!isFinite(num)) return "-"; return Number(num).toLocaleString(undefined,{maximumFractionDigits: digits}); }

  // Build arrays from CSV for type-level
  function getTypeArraysCSV(filterSet=null){
    const CSV = window.CSV_AGG || {};
    const arr = [];
    for (const [type, obj] of Object.entries(CSV)){
      if ((type||'').trim() === 'รวมทั้งหมด') continue;
      if (filterSet && !filterSet.has(type)) continue;
      arr.push({type, qty: obj.qty, weight: obj.weight, score: obj.carbon});
    }
    // sort by qty desc (donut/table)
    arr.sort((a,b)=> b.qty - a.qty);
    return arr;
  }

  // Baseline per-type carbon from raw rows (to compute scaling factors)
  function baselinePerType(){
    const data = window.__EW_ROWS__ || [];
    const perType = new Map();
    for (const r of data){
      const t = r.item_type || "ไม่ระบุ";
      const qty = r.quantity || 0;
      const wPer = calcWeightForType(t);
      const wt = qty * wPer;
      const sc = wt * FACTOR;
      const x = perType.get(t) || {qty:0, weight:0, score:0};
      x.qty += qty; x.weight += wt; x.score += sc;
      perType.set(t, x);
    }
    return perType;
  }

  const BASE = baselinePerType();
  const SCALE = {};
  for (const [t, x] of BASE.entries()){
    const csv = (window.CSV_AGG||{})[t];
    SCALE[t] = (csv && x.score>0) ? (csv.carbon / x.score) : 1.0;
  }

  // Full summarize respecting selected types; type-level from CSV, person/dept scaled to CSV per type
  window.summarizeCSV = function(filterSet=null){
    const data = window.__EW_ROWS__ || [];
    const byPerson = new Map(); const byDept = new Map();
    // Use CSV for type-level and totals
    const typeArr = getTypeArraysCSV(filterSet);

    // Totals from CSV per selected
    let totalItems = 0, totalWeight = 0, totalScore = 0;
    typeArr.forEach(t=>{ totalItems += t.qty; totalWeight += t.weight; totalScore += t.score; });

    // Person/Dept using scaled contributions and filter by type
    for (const r of data){
      const t = r.item_type || "ไม่ระบุ";
      if (filterSet && !filterSet.has(t)) continue;
      const qty = r.quantity || 0;
      const wPer = calcWeightForType(t);
      const wt = qty * wPer;
      const sc = wt * FACTOR;
      const s = SCALE[t] ?? 1.0;
      const scScaled = sc * s;

      const p = r.name || "ไม่ระบุ"; const px = byPerson.get(p) || {name:p, qty:0, weight:0, score:0};
      px.qty += qty; px.weight += wt; px.score += scScaled; byPerson.set(p, px);

      const d = r.department || "ไม่ระบุ"; const dx = byDept.get(d) || {department:d, qty:0, weight:0, score:0};
      dx.qty += qty; dx.weight += wt; dx.score += scScaled; byDept.set(d, dx);
    }
    const personArr = Array.from(byPerson.values()).sort((a,b)=>b.score-a.score);
    const deptArr = Array.from(byDept.values()).sort((a,b)=>b.score-a.score);
    return {typeArr, personArr, deptArr, totalItems, totalWeight, totalScore};
  };

  // Legend builder from CSV
  function buildLegend(allTypeArr){
    const legend = document.getElementById("legend");
    if (!legend) return;
    legend.innerHTML = "";
    allTypeArr.forEach((r,i)=>{
      const chip = document.createElement("span");
      chip.setAttribute("data-type", r.type);
      const color = (i%3===0?'#16a4dd':(i%3===1?'#666':'#000'));
      chip.innerHTML = `<i class="dot" style="background:${color}"></i>${r.type}`;
      chip.style.cursor="pointer";
      if (!window.selectedTypes || (window.selectedTypes && window.selectedTypes.has(r.type))) chip.classList.add("selected");
      legend.appendChild(chip);
    });
    if (!legend.__wired){
      legend.__wired = true;
      legend.addEventListener("click", (e)=>{
        const chip = e.target.closest("span[data-type]"); if(!chip) return;
        const t = chip.getAttribute("data-type");
        if (window.selectedTypes===null) window.selectedTypes = new Set();
        if (window.selectedTypes.has(t)) window.selectedTypes.delete(t); else window.selectedTypes.add(t);
        rerender();
      });
    }
  }

  // Buttons
  const btnSelAll = document.getElementById("btnSelectAll");
  if (btnSelAll && !btnSelAll.__wired){
    btnSelAll.__wired = true;
    btnSelAll.addEventListener("click", ()=>{ window.selectedTypes = null; rerender(); });
  }
  const btnClear = document.getElementById("btnClear");
  if (btnClear && !btnClear.__wired){
    btnClear.__wired = true;
    btnClear.addEventListener("click", ()=>{ window.selectedTypes = new Set(); rerender(); });
  }

  window.rerender = function(){
    // All types from CSV for legend and default donut
    const allTypes = getTypeArraysCSV(null);
    // Current filtered
    const filt = (window.selectedTypes instanceof Set && window.selectedTypes.size>0) ? window.selectedTypes : null;
    const agg = window.summarizeCSV(filt);

    // KPIs from CSV sums
    document.getElementById("kpi-items").textContent = nice(agg.totalItems,0);
    document.getElementById("kpi-weights").textContent = nice(agg.totalWeight,2);
    document.getElementById("kpi-carbon").textContent = nice(agg.totalScore,2);

    // Donut data = filtered types (or all if no filter), using CSV qty
    const donutData = (filt? agg.typeArr : allTypes);
    drawDonut(document.getElementById('donut'), donutData);

    // Type table (filtered list) with carbon from CSV, percent by qty within filtered
    updateTypeTable(agg.typeArr);

    // Charts (top 5) and tables (full) using scaled scores
    drawBars(document.getElementById("bar-people"), agg.personArr.slice(0,5), "name", "score", "people", 0.8, "#1e1e1e");
    updatePeopleTable(agg.personArr);
    drawBars(document.getElementById("bar-dept"), agg.deptArr.slice(0,5), "department", "score", "dept", 0.8, "#000000");
    updateDeptTable(agg.deptArr);

    // Legend with selection styling
    buildLegend(allTypes);
    const legend = document.getElementById("legend");
    if (legend){
      legend.querySelectorAll("span[data-type]").forEach(chip=>{
        const t = chip.getAttribute("data-type");
        const isSelected = !window.selectedTypes || window.selectedTypes.has(t);
        chip.style.opacity = isSelected ? "1" : "0.35";
        chip.style.borderColor = isSelected ? "#16a4dd" : "#eee";
        chip.classList.toggle("selected", isSelected);
      });
    }
  };

  if (document.readyState === "complete") window.rerender();
  else window.addEventListener("load", window.rerender);
})();
</script>
</body>
</html>
